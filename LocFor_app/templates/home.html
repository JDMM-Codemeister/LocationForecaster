{% extends "base.html" %}
{% block title %}Home Page{% endblock %}

{% block content %}
<style>
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0,0,0,0);
    border: 0;
  }

  /* Center the form horizontally at the top */
  .form-container {
    display: flex;
    justify-content: center;
    padding: 20px 0;
  }

  form {
    display: flex;
    gap: 10px;
  }

  input#location {
    font-size: 1.5rem;
    padding: 10px 15px;
    width: 300px;
    border: 2px solid #ccc;
    border-radius: 6px;
    outline: none;
    transition: border-color 0.3s ease;
  }
  input#location:focus {
    border-color: #007BFF;
  }

  button {
    font-size: 1.5rem;
    padding: 10px 25px;
    background-color: #000000;
    border: none;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #333333;
  }
</style>

<div class="form-container">
  <form method="GET" action="{% url 'home' %}" id="locationForm">
    <label for="location" class="sr-only">Location</label>
    <input id="location" name="location" type="text" placeholder="Enter location" value="{{ location|default_if_none:'' }}" required />

    <label for="year" class="sr-only">Year</label>
    <select id="year" name="year">
      <option value="2026" {% if year == '2026' %}selected{% endif %}>2026</option>
      <option value="2027" {% if year == '2027' %}selected{% endif %}>2027</option>
      <option value="2028" {% if year == '2028' %}selected{% endif %}>2028</option>
      <option value="2029" {% if year == '2029' %}selected{% endif %}>2029</option>
      <option value="2030" {% if year == '2030' %}selected{% endif %}>2030</option>
      <option value="2031" {% if year == '2031' %}selected{% endif %}>2031</option>
      <option value="2032" {% if year == '2032' %}selected{% endif %}>2032</option>
      <option value="2033" {% if year == '2033' %}selected{% endif %}>2033</option>
      <option value="2034" {% if year == '2034' %}selected{% endif %}>2034</option>
      <option value="2035" {% if year == '2035' %}selected{% endif %}>2035</option>
      <option value="2036" {% if year == '2036' %}selected{% endif %}>2036</option>
      <option value="2037" {% if year == '2037' %}selected{% endif %}>2037</option>
      <option value="2038" {% if year == '2038' %}selected{% endif %}>2038</option>
      <option value="2039" {% if year == '2039' %}selected{% endif %}>2039</option>
      <option value="2040" {% if year == '2040' %}selected{% endif %}>2040</option>
      <option value="2041" {% if year == '2041' %}selected{% endif %}>2041</option>
      <option value="2042" {% if year == '2042' %}selected{% endif %}>2042</option>
      <option value="2043" {% if year == '2043' %}selected{% endif %}>2043</option>
      <option value="2044" {% if year == '2044' %}selected{% endif %}>2044</option>
      <option value="2045" {% if year == '2045' %}selected{% endif %}>2045</option>
      <option value="2046" {% if year == '2046' %}selected{% endif %}>2046</option>
      <option value="2047" {% if year == '2047' %}selected{% endif %}>2047</option>
      <option value="2048" {% if year == '2048' %}selected{% endif %}>2048</option>
      <option value="2049" {% if year == '2049' %}selected{% endif %}>2049</option>
      <option value="2050" {% if year == '2050' %}selected{% endif %}>2050</option>
      <option value="2051" {% if year == '2051' %}selected{% endif %}>2051</option>
      <option value="2052" {% if year == '2052' %}selected{% endif %}>2052</option>
      <option value="2053" {% if year == '2053' %}selected{% endif %}>2053</option>
      <option value="2054" {% if year == '2054' %}selected{% endif %}>2054</option>
      <option value="2055" {% if year == '2055' %}selected{% endif %}>2055</option>
      <option value="2056" {% if year == '2056' %}selected{% endif %}>2056</option>
      <option value="2057" {% if year == '2057' %}selected{% endif %}>2057</option>
      <option value="2058" {% if year == '2058' %}selected{% endif %}>2058</option>
      <option value="2059" {% if year == '2059' %}selected{% endif %}>2059</option>
      <option value="2060" {% if year == '2060' %}selected{% endif %}>2060</option>
    </select>

    <button type="submit">Forecast</button>
  </form>
</div>



{% if forecast_result %}
  <p style="text-align:center;padding-bottom: 20px;",>{{ forecast_result }}</p>
{% endif %}

<div id="map" style="height: 400px; width: 100%;"></div>

<!-- Leaflet CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
let map = L.map('map').setView([20, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// If location provided by Django, geocode and move map
{% if location %}
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q={{ location|urlencode }}`)
        .then(response => response.json())
        .then(data => {
            if (data.length > 0) {
                let lat = parseFloat(data[0].lat);
                let lon = parseFloat(data[0].lon);
                map.setView([lat, lon], 13);
                L.marker([lat, lon]).addTo(map).bindPopup("{{ location }}").openPopup();
            }
        });
{% endif %}
</script>
{% endblock %}